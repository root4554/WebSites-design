{"version":3,"file":"filter-drop-shadow.js","sources":["../src/DropShadowFilter.ts"],"sourcesContent":["import { KawaseBlurFilter } from '@pixi/filter-kawase-blur';\nimport { vertex } from '@tools/fragments';\nimport fragment from './dropshadow.frag';\nimport { Filter, settings, DEG_TO_RAD, Point, utils } from '@pixi/core';\nimport type { IPoint, CLEAR_MODES, FilterSystem, RenderTexture } from '@pixi/core';\n\ntype PixelSizeValue = number | number[] | IPoint;\n\ninterface DropShadowFilterOptions\n{\n    rotation: number;\n    distance: number;\n    color: number;\n    alpha: number;\n    shadowOnly: boolean;\n    blur: number;\n    quality: number;\n    kernels: number[] | null;\n    pixelSize: PixelSizeValue;\n    resolution: number;\n}\n\n/**\n * Drop shadow filter.<br>\n * ![original](../tools/screenshots/dist/original.png)![filter](../tools/screenshots/dist/drop-shadow.png)\n * @class\n * @extends PIXI.Filter\n * @see {@link https://www.npmjs.com/package/@pixi/filter-drop-shadow|@pixi/filter-drop-shadow}\n * @see {@link https://www.npmjs.com/package/pixi-filters|pixi-filters}\n */\nclass DropShadowFilter extends Filter\n{\n    /** Default constructor options. */\n    public static readonly defaults: DropShadowFilterOptions = {\n        rotation: 45,\n        distance: 5,\n        color: 0x000000,\n        alpha: 0.5,\n        shadowOnly: false,\n        kernels: null,\n        blur: 2,\n        quality: 3,\n        pixelSize: 1,\n        resolution: settings.FILTER_RESOLUTION,\n    };\n\n    /** Hide the contents, only show the shadow. */\n    public shadowOnly: boolean;\n\n    /** Angle of the shadow in degrees. */\n    public angle = 45;\n\n    private _distance = 5;\n    private _tintFilter: Filter;\n    private _blurFilter: KawaseBlurFilter;\n    protected _resolution: number = settings.FILTER_RESOLUTION;\n\n    /**\n     * @param {object} [options] - Filter options\n     * @param {number} [options.rotation=45] - The angle of the shadow in degrees.\n     * @param {number} [options.distance=5] - Distance of shadow\n     * @param {number} [options.color=0x000000] - Color of the shadow\n     * @param {number} [options.alpha=0.5] - Alpha of the shadow\n     * @param {boolean} [options.shadowOnly=false] - Whether render shadow only\n     * @param {number} [options.blur=2] - Sets the strength of the Blur properties simultaneously\n     * @param {number} [options.quality=3] - The quality of the Blur filter.\n     * @param {number[]} [options.kernels=null] - The kernels of the Blur filter.\n     * @param {number|number[]|PIXI.Point} [options.pixelSize=1] - the pixelSize of the Blur filter.\n     * @param {number} [options.resolution=PIXI.settings.FILTER_RESOLUTION] - The resolution of the Blur filter.\n     */\n    constructor(options?: Partial<DropShadowFilterOptions>)\n    {\n        super();\n\n        const opt: DropShadowFilterOptions = options\n            ? { ...DropShadowFilter.defaults, ...options }\n            : DropShadowFilter.defaults;\n\n        const { kernels, blur, quality, pixelSize, resolution } = opt;\n\n        this._tintFilter = new Filter(vertex, fragment);\n        this._tintFilter.uniforms.color = new Float32Array(4);\n        this._tintFilter.uniforms.shift = new Point();\n        this._tintFilter.resolution = resolution;\n        this._blurFilter = kernels\n            ? new KawaseBlurFilter(kernels)\n            : new KawaseBlurFilter(blur, quality);\n\n        this.pixelSize = pixelSize;\n        this.resolution = resolution;\n\n        const { shadowOnly, rotation, distance, alpha, color } = opt;\n\n        this.shadowOnly = shadowOnly;\n        this.rotation = rotation;\n        this.distance = distance;\n        this.alpha = alpha;\n        this.color = color;\n\n        this._updatePadding();\n    }\n\n    apply(filterManager: FilterSystem, input: RenderTexture, output: RenderTexture, clear: CLEAR_MODES): void\n    {\n        const target = filterManager.getFilterTexture();\n\n        this._tintFilter.apply(filterManager, input, target, 1);\n        this._blurFilter.apply(filterManager, target, output, clear);\n\n        if (this.shadowOnly !== true)\n        {\n            filterManager.applyFilter(this, input, output, 0);\n        }\n\n        filterManager.returnFilterTexture(target);\n    }\n\n    /**\n     * Recalculate the proper padding amount.\n     * @private\n     */\n    private _updatePadding()\n    {\n        this.padding = this.distance + (this.blur * 2);\n    }\n\n    /**\n     * Update the transform matrix of offset angle.\n     * @private\n     */\n    private _updateShift()\n    {\n        this._tintFilter.uniforms.shift.set(\n            this.distance * Math.cos(this.angle),\n            this.distance * Math.sin(this.angle),\n        );\n    }\n\n    /**\n     * The resolution of the filter.\n     * @default PIXI.settings.FILTER_RESOLUTION\n     */\n    get resolution(): number\n    {\n        return this._resolution;\n    }\n    set resolution(value: number)\n    {\n        this._resolution = value;\n\n        if (this._tintFilter)\n        {\n            this._tintFilter.resolution = value;\n        }\n        if (this._blurFilter)\n        {\n            this._blurFilter.resolution = value;\n        }\n    }\n\n    /**\n     * Distance offset of the shadow\n     * @default 5\n     */\n    get distance(): number\n    {\n        return this._distance;\n    }\n    set distance(value: number)\n    {\n        this._distance = value;\n        this._updatePadding();\n        this._updateShift();\n    }\n\n    /**\n     * The angle of the shadow in degrees\n     * @default 2\n     */\n    get rotation(): number\n    {\n        return this.angle / DEG_TO_RAD;\n    }\n    set rotation(value: number)\n    {\n        this.angle = value * DEG_TO_RAD;\n        this._updateShift();\n    }\n\n    /**\n     * The alpha of the shadow\n     * @default 1\n     */\n    get alpha(): number\n    {\n        return this._tintFilter.uniforms.alpha;\n    }\n    set alpha(value: number)\n    {\n        this._tintFilter.uniforms.alpha = value;\n    }\n\n    /**\n     * The color of the shadow.\n     * @default 0x000000\n     */\n    get color(): number\n    {\n        return utils.rgb2hex(this._tintFilter.uniforms.color);\n    }\n    set color(value: number)\n    {\n        utils.hex2rgb(value, this._tintFilter.uniforms.color);\n    }\n\n    /**\n     * Sets the kernels of the Blur Filter\n     */\n    get kernels(): number[]\n    {\n        return this._blurFilter.kernels;\n    }\n    set kernels(value: number[])\n    {\n        this._blurFilter.kernels = value;\n    }\n\n    /**\n     * The blur of the shadow\n     * @default 2\n     */\n    get blur(): number\n    {\n        return this._blurFilter.blur;\n    }\n    set blur(value: number)\n    {\n        this._blurFilter.blur = value;\n        this._updatePadding();\n    }\n\n    /**\n     * Sets the quality of the Blur Filter\n     * @default 4\n     */\n    get quality(): number\n    {\n        return this._blurFilter.quality;\n    }\n    set quality(value: number)\n    {\n        this._blurFilter.quality = value;\n    }\n\n    /**\n     * Sets the pixelSize of the Kawase Blur filter\n     *\n     * @member {number|number[]|PIXI.Point}\n     * @default 1\n     */\n    get pixelSize(): PixelSizeValue\n    {\n        return this._blurFilter.pixelSize;\n    }\n    set pixelSize(value: PixelSizeValue)\n    {\n        this._blurFilter.pixelSize = value;\n    }\n}\n\nexport { DropShadowFilter };\nexport type { DropShadowFilterOptions };\n"],"names":["_DropShadowFilter","Filter","options","settings","opt","__spreadValues","kernels","blur","quality","pixelSize","resolution","vertex","fragment","Point","KawaseBlurFilter","shadowOnly","rotation","distance","alpha","color","filterManager","input","output","clear","target","value","DEG_TO_RAD","utils","DropShadowFilter"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;4UA8BA,MAAMA,EAAN,cAA+BC,EAC/B,MAAA,CAuCI,YAAYC,EACZ,CACI,MAAA,EAtBJ,KAAO,MAAQ,GAEf,KAAQ,UAAY,EAGpB,KAAU,YAAsBC,EAAAA,SAAS,kBAmBrC,MAAMC,EAA+BF,EAC/BG,IAAA,CAAA,EAAKL,EAAiB,QAAaE,EAAAA,CAAAA,EACnCF,EAAiB,SAEjB,CAAE,QAAAM,EAAS,KAAAC,EAAM,QAAAC,EAAS,UAAAC,EAAW,WAAAC,CAAW,EAAIN,EAE1D,KAAK,YAAc,IAAIH,EAAOU,OAAAA,EAAQC,CAAQ,EAC9C,KAAK,YAAY,SAAS,MAAQ,IAAI,aAAa,CAAC,EACpD,KAAK,YAAY,SAAS,MAAQ,IAAIC,QACtC,KAAK,YAAY,WAAaH,EAC9B,KAAK,YAAcJ,EACb,IAAIQ,EAAAA,iBAAiBR,CAAO,EAC5B,IAAIQ,EAAAA,iBAAiBP,EAAMC,CAAO,EAExC,KAAK,UAAYC,EACjB,KAAK,WAAaC,EAElB,KAAM,CAAE,WAAAK,EAAY,SAAAC,EAAU,SAAAC,EAAU,MAAAC,EAAO,MAAAC,CAAM,EAAIf,EAEzD,KAAK,WAAaW,EAClB,KAAK,SAAWC,EAChB,KAAK,SAAWC,EAChB,KAAK,MAAQC,EACb,KAAK,MAAQC,EAEb,KAAK,eAAA,CACT,CAEA,MAAMC,EAA6BC,EAAsBC,EAAuBC,EAChF,CACI,MAAMC,EAASJ,EAAc,iBAE7B,EAAA,KAAK,YAAY,MAAMA,EAAeC,EAAOG,EAAQ,CAAC,EACtD,KAAK,YAAY,MAAMJ,EAAeI,EAAQF,EAAQC,CAAK,EAEvD,KAAK,aAAe,IAEpBH,EAAc,YAAY,KAAMC,EAAOC,EAAQ,CAAC,EAGpDF,EAAc,oBAAoBI,CAAM,CAC5C,CAMQ,gBACR,CACI,KAAK,QAAU,KAAK,SAAY,KAAK,KAAO,CAChD,CAMQ,cACR,CACI,KAAK,YAAY,SAAS,MAAM,IAC5B,KAAK,SAAW,KAAK,IAAI,KAAK,KAAK,EACnC,KAAK,SAAW,KAAK,IAAI,KAAK,KAAK,CACvC,CACJ,CAMA,IAAI,YACJ,CACI,OAAO,KAAK,WAChB,CACA,IAAI,WAAWC,EACf,CACI,KAAK,YAAcA,EAEf,KAAK,cAEL,KAAK,YAAY,WAAaA,GAE9B,KAAK,cAEL,KAAK,YAAY,WAAaA,EAEtC,CAMA,IAAI,UACJ,CACI,OAAO,KAAK,SAChB,CACA,IAAI,SAASA,EACb,CACI,KAAK,UAAYA,EACjB,KAAK,iBACL,KAAK,cACT,CAMA,IAAI,UACJ,CACI,OAAO,KAAK,MAAQC,YACxB,CACA,IAAI,SAASD,EACb,CACI,KAAK,MAAQA,EAAQC,EACrB,WAAA,KAAK,aACT,CAAA,CAMA,IAAI,OACJ,CACI,OAAO,KAAK,YAAY,SAAS,KACrC,CACA,IAAI,MAAMD,EACV,CACI,KAAK,YAAY,SAAS,MAAQA,CACtC,CAMA,IAAI,OACJ,CACI,OAAOE,EAAAA,MAAM,QAAQ,KAAK,YAAY,SAAS,KAAK,CACxD,CACA,IAAI,MAAMF,EACV,CACIE,EAAAA,MAAM,QAAQF,EAAO,KAAK,YAAY,SAAS,KAAK,CACxD,CAKA,IAAI,SACJ,CACI,OAAO,KAAK,YAAY,OAC5B,CACA,IAAI,QAAQA,EACZ,CACI,KAAK,YAAY,QAAUA,CAC/B,CAMA,IAAI,MACJ,CACI,OAAO,KAAK,YAAY,IAC5B,CACA,IAAI,KAAKA,EACT,CACI,KAAK,YAAY,KAAOA,EACxB,KAAK,gBACT,CAMA,IAAI,SACJ,CACI,OAAO,KAAK,YAAY,OAC5B,CACA,IAAI,QAAQA,EACZ,CACI,KAAK,YAAY,QAAUA,CAC/B,CAQA,IAAI,WACJ,CACI,OAAO,KAAK,YAAY,SAC5B,CACA,IAAI,UAAUA,EACd,CACI,KAAK,YAAY,UAAYA,CACjC,CACJ,EA9OA,IAAMG,EAAN5B,EAAM4B,EAGqB,SAAoC,CACvD,SAAU,GACV,SAAU,EACV,MAAO,EACP,MAAO,GACP,WAAY,GACZ,QAAS,KACT,KAAM,EACN,QAAS,EACT,UAAW,EACX,WAAYzB,EAAAA,SAAS,iBACzB"}